/*
Description			: use 'child_process'
Default value		: /
The scope of value	: /
First used			: /
*/
var spawn = require('child_process').spawn;

/*
Description			: use 'fs'
Default value		: /
The scope of value	: /
First used			: /
*/
var fs = require('fs');

/*
Description			: define a stdio mode object.
Default value		: /
The scope of value	: /
First used			: /
*/
var g_stdioMode = new Array('inherit','ignore');

/*
Description			: bash shell directory
Default value		: /
The scope of value	:
First used			:
*/
var BASE_PATH = './c_processes/';

/***********************************************************************
**Function Name	: Run
**Description	: run a c process.
**Parameters	: processName {String} - in
				: isRestart {Number} - in(0 - do not restart c process, 1 - if the c process is killed, we will restart the process)
				: startSum {Number} - the number of restarting(-1 - unlimit).
				: stdioMode {Number} - stdio mode(0 - display output information from c process, 1 - no)
**Return		: none.
***********************************************************************/
function Run(processName, isRestart, startSum, stdioMode)
{	
	var ls = spawn('ls', [(BASE_PATH + processName + '/' + 'update_failed')]);	//-- check c process status updated --//
		
	var chmod = spawn('chmod',[777, (BASE_PATH + processName + '/' + processName)]);
	
	chmod.once('close', function(err){

		if (err)
		{
			console.log("RunCProcess(chmod):",err.errno);
		}
		else
		{
			var cProcess = spawn((BASE_PATH + processName + '/' + processName), [], {stdio:g_stdioMode[stdioMode]});
			
			cProcess.once('close', function(err){
		
				if (err)
				{
					console.log("Run(cProcess):",err.errno);
				}
				else
				{
					if (1 === isRestart)
					{	 	
						if(0 < startSum)
						{
							startSum--;
							console.log("Restart", processName);
							Run(processName, isRestart, startSum, stdioMode);

						}
						else if (0 === startSum)
						{
							console.log(processName + " stop running!");
						}
						else
						{
							console.log("Restart", processName);
							Run(processName, isRestart, startSum, stdioMode);				
						}			

				   }
				   else
				   {
				   		console.log(processName + " stop running!");
				   }
				   
				} //--- end of if (err)) ---//
			   
			}); //--- end of cProcess.on('close', function(err) ---//
	
		} //--- end of if (err) ---//
	
	}); //--- end of chmod.on('close', function(err) ---//			

}

exports.Run = Run;





